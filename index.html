<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Irish Money Planner — v4.2 (Pension slice in monthly split)</title>
  <style>
    :root{--bg:#0b0f14;--ink:#e6edf3;--muted:#9fb0c5;--card:#101722;--line:#223044;--accent:#7c5cff;--accent2:#22c55e;--warn:#f59e0b}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto; color:var(--ink); background:radial-gradient(1200px 900px at 85% -20%, #1a2230 15%, transparent 60%) var(--bg)}
    a{color:var(--accent);text-decoration:none}
    header{position:sticky;top:0;z-index:50;background:#0b0f1490;backdrop-filter:blur(8px) saturate(160%);border-bottom:1px solid #141d2a}
    .nav{max-width:1200px;margin:auto;display:flex;gap:16px;align-items:center;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .brand svg{filter:drop-shadow(0 6px 18px #0006)}
    .spacer{flex:1}
    .nav a{color:#cbd5e1;padding:8px 10px;border-radius:10px}
    .nav a:hover{background:#0e1622}

    main{max-width:1100px;margin:0 auto}
    section.page{min-height:100vh;display:flex;flex-direction:column;justify-content:center;padding:32px 16px;scroll-margin-top:76px}
    .card{background:linear-gradient(180deg,#101722,#0f141b);border:1px solid var(--line);border-radius:18px;padding:18px}
    h1,h2{margin:0 0 10px}
    h1{font-size:2rem}
    h2{font-size:1.25rem}
    .hint{color:var(--muted);font-size:.95rem;margin-bottom:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    label{display:block;font-size:.9rem;color:#a7b4c7;margin:6px 0}
    input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #213144;background:#0c1219;color:var(--ink)}
    input:focus,select:focus{outline:none;box-shadow:0 0 0 2px var(--accent)}
    button{cursor:pointer}
    .primary{background:linear-gradient(180deg,var(--accent),#6a4bf6);border:none}
    .ghost{background:#0f172a}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px}
    .kpi{display:flex;justify-content:space-between;align-items:center;padding:12px;background:#0c1219;border:1px solid var(--line);border-radius:12px}
    .mono{font-variant-numeric:tabular-nums}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    .mt12{margin-top:12px}
    .chart{background:#0c1219;border:1px solid var(--line);border-radius:14px;padding:8px;display:flex;align-items:center;justify-content:center;min-height:260px}
    .legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:8px}
    .legend span{display:inline-flex;align-items:center;gap:6px;font-size:.9rem;color:#c8d3e1}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .footer{opacity:.7;text-align:center;padding:28px 0}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">
        <svg width="28" height="28" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7c5cff"/><stop offset="100%" stop-color="#22c55e"/></linearGradient></defs><rect x="6" y="6" width="36" height="36" rx="10" fill="url(#g)"/></svg>
        <span>Irish Money Planner — v4.2</span>
      </div>
      <div class="spacer"></div>
      <a href="#salary">Salary</a>
      <a href="#pension">Pension</a>
      <a href="#tax">Tax</a>
      <a href="#expenses">Expenses</a>
      <a href="#saving-spending">Saving & Spending</a>
      <a href="#overview">Overview</a>
    </div>
  </header>

  <section class="page" style="min-height:auto;padding-top:18px;padding-bottom:12px">
    <div class="card" style="max-width:1100px;margin:0 auto">
      <h2 style="margin-bottom:6px">What this site does</h2>
      <p class="hint" style="margin:0">Charts update when you click Calculate/Update. The <strong>Saving & Spending</strong> pie now shows <strong>Expenses</strong>, <strong>Employee pension</strong>, <strong>Savings</strong>, and <strong>Free</strong>.</p>
    </div>
  </section>

  <main>
    <!-- SALARY -->
    <section id="salary" class="page">
      <div class="split">
        <div>
          <h1>Salary</h1>
          <div class="card">
            <div class="row">
              <div><label for="freq">Input frequency</label><select id="freq"><option value="annual">Annual</option><option value="monthly">Monthly</option><option value="biweekly">Bi‑weekly (26)</option><option value="weekly">Weekly (52)</option><option value="hourly">Hourly</option></select></div>
              <div><label for="amount">Amount</label><input id="amount" type="number" min="0" step="0.01" placeholder="e.g. 45000" /></div>
            </div>
            <div class="row mt12" id="hoursRow" style="display:none"><div><label for="hours">Hours per week</label><input id="hours" type="number" min="0" step="0.1" value="39" /></div><div><label>&nbsp;</label><button id="presetFT" class="ghost" type="button">Set 39h / wk</button></div></div>
            <div class="row mt12"><div><button id="calcSalary" class="primary" type="button">Calculate</button></div></div>
            <div class="kpis"><div class="kpi"><span>Annual</span><strong class="mono" id="salAnnual">€0</strong></div><div class="kpi"><span>Monthly</span><strong class="mono" id="salMonthly">€0</strong></div><div class="kpi"><span>Bi‑weekly</span><strong class="mono" id="salBiweekly">€0</strong></div><div class="kpi"><span>Weekly</span><strong class="mono" id="salWeekly">€0</strong></div></div>
          </div>
        </div>
        <div class="card"><h2>Note</h2><p class="hint">Other pages use this value. Confirm it first.</p></div>
      </div>
    </section>

    <!-- PENSION -->
    <section id="pension" class="page">
      <div class="split">
        <div>
          <h1>Pension contributions</h1>
          <p class="hint">Enter your %s, assumed return, and years. <strong>Employee % of wages becomes its own slice in Saving & Spending.</strong></p>
          <div class="card">
            <div class="row3">
              <div><label for="eePct">Your % of gross</label><input id="eePct" type="number" min="0" max="100" step="0.1" value="5"></div>
              <div><label for="erPct">Employer match %</label><input id="erPct" type="number" min="0" max="100" step="0.1" value="5"></div>
              <div><label for="retPct">Assumed return % (annual)</label><input id="retPct" type="number" min="-10" max="20" step="0.1" value="5"></div>
            </div>
            <div class="row mt12"><div><label for="penYears">Years</label><input id="penYears" type="number" min="1" max="60" step="1" value="50"></div><div><label>&nbsp;</label><button id="calcPension" class="primary" type="button">Calculate</button></div></div>
            <div class="kpis"><div class="kpi"><span>Employee €/yr</span><strong class="mono" id="penEE">€0</strong></div><div class="kpi"><span>Employer €/yr</span><strong class="mono" id="penER">€0</strong></div><div class="kpi"><span>Monthly total</span><strong class="mono" id="penMonthly">€0</strong></div><div class="kpi"><span>Projected pot</span><strong class="mono" id="penPot">€0</strong></div></div>
          </div>
        </div>
        <div class="card">
          <h2>Growth over time</h2>
          <div class="chart"><svg id="chartPension" viewBox="0 0 420 260" width="100%" height="100%"></svg></div>
        </div>
      </div>
    </section>

    <!-- TAX (pie) -->
    <section id="tax" class="page">
      <div class="split">
        <div>
          <h1>Tax (Ireland 2025)</h1>
          <p class="hint">PAYE + USC + PRSI. Uses your Salary from page 1.</p>
          <div class="card">
            <div class="row3">
              <div><label for="status">Status</label><select id="status"><option value="single" selected>Single</option><option value="married_one">Married (one income)</option><option value="married_two">Married (both incomes)</option><option value="single_parent">Single parent</option></select></div>
              <div><label for="credits">Base tax credits €/yr</label><input id="credits" type="number" min="0" step="1" value="4000"></div>
              <div><label for="rentCredit">Rent tax credit €/yr</label><input id="rentCredit" type="number" min="0" step="1" value="0"></div>
            </div>
            <div class="row3 mt12"><div><label for="medicalEligible">Medical expenses eligible (€)</label><input id="medicalEligible" type="number" min="0" step="1" value="0"></div><div><label>&nbsp;</label><button id="calcTax" class="primary" type="button">Calculate</button></div><div><label>&nbsp;</label><div class="kpi"><span>Using gross</span><strong class="mono" id="taxUsingGross">€0</strong></div></div></div>
            <div class="kpis"><div class="kpi"><span>PAYE</span><strong class="mono" id="outPAYE">€0</strong></div><div class="kpi"><span>USC</span><strong class="mono" id="outUSC">€0</strong></div><div class="kpi"><span>PRSI</span><strong class="mono" id="outPRSI">€0</strong></div><div class="kpi"><span>Total tax</span><strong class="mono" id="outTax">€0</strong></div></div>
            <div class="kpis" style="grid-template-columns:repeat(2,1fr)"><div class="kpi"><span>Net annual</span><strong class="mono" id="netAnnual">€0</strong></div><div class="kpi"><span>Net monthly</span><strong class="mono" id="netMonthly">€0</strong></div></div>
          </div>
        </div>
        <div class="card"><h2>Tax split</h2><div class="chart"><svg id="chartTaxPie" viewBox="0 0 420 260" width="100%" height="100%"></svg></div><div class="legend" id="legendTax"></div></div>
      </div>
    </section>

    <!-- EXPENSES (bars) -->
    <section id="expenses" class="page">
      <div class="split">
        <div>
          <h1>Expenses</h1>
          <div class="card">
            <div class="row mt12"><div><button id="addExp" type="button" class="ghost">+ Add expense</button></div><div><button id="clearExp" type="button" class="ghost">Clear</button></div><div><button id="calcExp" type="button" class="primary">Update</button></div></div>
            <table class="mt12" id="expTable"><thead><tr><th>Name</th><th>Amount</th><th>Freq</th><th class="right">Annualised</th><th></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="3" style="text-align:right">Total (annual)</td><td id="expTotal" class="mono">€0</td><td></td></tr><tr><td colspan="3" style="text-align:right">Total (monthly)</td><td id="expTotalMonthly" class="mono">€0</td><td></td></tr></tfoot></table>
          </div>
        </div>
        <div class="card"><h2>Where it goes</h2><div class="chart"><svg id="chartExpenses" viewBox="0 0 420 260" width="100%" height="100%"></svg></div></div>
      </div>
    </section>

    <!-- SAVING & SPENDING (pie with pension slice + savings control) -->
    <section id="saving-spending" class="page">
      <div class="split">
        <div>
          <h1>Saving & Spending</h1>
          <p class="hint">Proportion of your net monthly that goes to <strong>Expenses</strong>, <strong>Employee pension</strong> (your % of gross), <strong>Savings</strong> (your chosen % of net), and <strong>Free</strong>.</p>
          <div class="card">
            <div class="row">
              <div><label for="saveRate">Target savings % of net</label><input id="saveRate" type="number" min="0" max="100" step="0.5" value="20"></div>
              <div><label>&nbsp;</label><button id="calcSave" class="primary" type="button">Apply</button></div>
            </div>
            <div class="kpis" style="grid-template-columns:repeat(4,1fr)">
              <div class="kpi"><span>Net monthly</span><strong class="mono" id="spNetMonthly">€0</strong></div>
              <div class="kpi"><span>Expenses monthly</span><strong class="mono" id="spExpMonthly">€0</strong></div>
              <div class="kpi"><span>Pension (EE) monthly</span><strong class="mono" id="spPenMonthly">€0</strong></div>
              <div class="kpi"><span>Free to spend (mo)</span><strong class="mono" id="spFreeMonthly">€0</strong></div>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Monthly split (pie)</h2>
          <div class="chart"><svg id="chartSpendingPie" viewBox="0 0 420 260" width="100%" height="100%"></svg></div>
          <div class="legend"><span><i class="dot" style="background:#7c5cff"></i>Expenses</span><span><i class="dot" style="background:#a78bfa"></i>Pension (EE)</span><span><i class="dot" style="background:#22c55e"></i>Savings</span><span><i class="dot" style="background:#94a3b8"></i>Free</span></div>
        </div>
      </div>
    </section>

    <!-- OVERVIEW -->
    <section id="overview" class="page">
      <div class="split">
        <div>
          <h1>Overview & goals</h1>
          <p class="hint">Summary + time-to-goal chart with year and amount labels.</p>
          <div class="card">
            <div class="kpis" style="grid-template-columns:repeat(4,1fr)"><div class="kpi"><span>Gross annual</span><strong class="mono" id="ovGross">€0</strong></div><div class="kpi"><span>Total tax</span><strong class="mono" id="ovTax">€0</strong></div><div class="kpi"><span>Net annual</span><strong class="mono" id="ovNet">€0</strong></div><div class="kpi"><span>Expenses annual</span><strong class="mono" id="ovExp">€0</strong></div></div>
            <div class="kpis" style="grid-template-columns:repeat(3,1fr)"><div class="kpi"><span>Free cashflow (yr)</span><strong class="mono" id="ovFree">€0</strong></div><div class="kpi"><span>Suggested saving (mo)</span><strong class="mono" id="ovSaveMo">€0</strong></div><div class="kpi"><span>Runway (months)</span><strong class="mono" id="ovRunway">—</strong></div></div>
            <div class="row mt12"><div><label for="goalAmount">Goal amount (€)</label><input id="goalAmount" type="number" min="0" step="1" value="10000"></div><div><label for="goalCurrent">Current saved (€)</label><input id="goalCurrent" type="number" min="0" step="1" value="0"></div></div>
            <div class="row mt12"><div><label for="goalMonthly">Monthly contribution (€)</label><input id="goalMonthly" type="number" min="0" step="1" value="500"></div><div><label>&nbsp;</label><button id="calcGoal" class="primary" type="button">Calculate goal</button></div></div>
            <div class="kpis" style="grid-template-columns:repeat(2,1fr)"><div class="kpi"><span>Months to goal</span><strong class="mono" id="goalMonths">—</strong></div><div class="kpi"><span>Target date</span><strong class="mono" id="goalDate">—</strong></div></div>
          </div>
        </div>
        <div class="card"><h2>Goal timeline</h2><div class="chart"><svg id="chartGoal" viewBox="0 0 420 260" width="100%" height="100%"></svg></div></div>
      </div>
    </section>

    <div class="footer hint">No data leaves your browser. 2025 Irish tax model; verify specifics for your case.</div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const fmt = n => Number(n||0).toLocaleString(undefined,{style:'currency',currency:'EUR',maximumFractionDigits:0});
      const state = { annualGross:0, netAnnual:0, totalTax:0, expensesAnnual:0, saveRate:0.20, eePct:0 };
      const PALETTE = ['#7c5cff','#22c55e','#ef4444','#f59e0b','#06b6d4','#a78bfa','#10b981','#eab308','#f97316','#3b82f6'];

      // Helpers
      function arcPath(cx,cy,r,startDeg,endDeg){ const toRad=a=> (a-90)*Math.PI/180; const a0=toRad(startDeg), a1=toRad(endDeg); const x0=cx+r*Math.cos(a0), y0=cy+r*Math.sin(a0); const x1=cx+r*Math.cos(a1), y1=cy+r*Math.sin(a1); const large=(endDeg-startDeg)>180?1:0; return `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`; }

      // ===== Salary =====
      const freqEl = document.getElementById('freq');
      const amountEl = document.getElementById('amount');
      const hoursRow = document.getElementById('hoursRow');
      const hoursEl = document.getElementById('hours');
      function toAnnual(freq, amount, hours){ const v = Number(amount||0); switch(freq){case 'annual': return v; case 'monthly': return v*12; case 'biweekly': return v*26; case 'weekly': return v*52; case 'hourly': return v*Number(hours||0)*52; default: return 0;} }
      function fillSalary(a){ document.getElementById('salAnnual').textContent = fmt(a); document.getElementById('salMonthly').textContent = fmt(a/12); document.getElementById('salBiweekly').textContent = fmt(a/26); document.getElementById('salWeekly').textContent = fmt(a/52); }
      document.getElementById('calcSalary').addEventListener('click', ()=>{ const a = toAnnual(freqEl.value, amountEl.value, hoursEl.value); state.annualGross = a; fillSalary(a); updateAllViews(); });
      freqEl.addEventListener('change', ()=>{ hoursRow.style.display = freqEl.value==='hourly' ? '' : 'none'; });
      document.getElementById('presetFT').addEventListener('click',()=>{hoursEl.value=39});

      // ===== Pension =====
      function fvSeries(monthly, years, annualReturn){ const r = (annualReturn/100)/12; const n = years*12; if(r===0) return monthly*n; return monthly*((Math.pow(1+r,n)-1)/r); }
      function renderPensionChart(monthly, years, annualReturn){ const svg=document.getElementById('chartPension'); svg.innerHTML=''; const w=420,h=260,p=36; const r=(annualReturn/100)/12; const n=years*12; const points=120; const step=Math.max(1, Math.floor(n/points)); let vals=[]; let bal=0; for(let m=0;m<=n;m+=step){ if(m>0) bal = bal*(1+r) + monthly*step; vals.push({m,bal}); } const max=Math.max(1, ...vals.map(v=>v.bal)); const sx=(w-2*p)/(vals.length-1||1); const sy=(h-2*p)/max; let d=''; vals.forEach((v,i)=>{ const x=p + i*sx; const y=h-p - v.bal*sy; d += (i? ' L ':'M ')+x+' '+y; }); const yearsTotal = years; let grid=''; for(let y=0;y<=yearsTotal;y+=10){ const i=Math.round((y/yearsTotal)*(vals.length-1)); const x=p + i*sx; grid += `<line x1="${x}" y1="${h-p}" x2="${x}" y2="${p}" stroke="#1f2b3d" stroke-dasharray="4 4"/>` + `<text x="${x}" y="${h-p+16}" text-anchor="middle" fill="#9fb0c5" font-size="12">${y}y</text>`; } const yTicks=[0,0.25,0.5,0.75,1].map(fr=> fr*max); yTicks.forEach(v=>{ const y=h-p - v*sy; grid += `<line x1="${p}" y1="${y}" x2="${w-p}" y2="${y}" stroke="#1f2b3d" stroke-dasharray="4 4"/>` + `<text x="${p-8}" y="${y+4}" text-anchor="end" fill="#9fb0c5" font-size="12">${fmt(v)}</text>`; }); const endX=p + (vals.length-1)*sx; const endY=h-p - vals[vals.length-1].bal*sy; const endLabel = fmt(vals[vals.length-1].bal); svg.innerHTML = `${grid}<path d="${d}" fill="none" stroke="#7c5cff" stroke-width="3"/>` + `<circle cx="${endX}" cy="${endY}" r="4" fill="#22c55e"/>` + `<text x="${endX-6}" y="${endY-8}" fill="#e5e7eb" font-size="12" text-anchor="end">${endLabel} (${years}y)</text>`; }
      document.getElementById('calcPension').addEventListener('click', ()=>{ const eePct=Number(document.getElementById('eePct').value||0); state.eePct=eePct; const ee = eePct/100 * state.annualGross; const er = Number(document.getElementById('erPct').value||0)/100 * state.annualGross; const monthly = (ee+er)/12; const years=Number(document.getElementById('penYears').value||0); const ret=Number(document.getElementById('retPct').value||0); const fv=fvSeries(monthly, years, ret); document.getElementById('penEE').textContent = fmt(ee); document.getElementById('penER').textContent = fmt(er); document.getElementById('penMonthly').textContent = fmt(monthly); document.getElementById('penPot').textContent = fmt(fv); renderPensionChart(monthly, years, ret); updateAllViews(); });

      // ===== Tax =====
      const TAX = { standard:0.20, higher:0.40, bands:{single:44000,married_one:53000,married_two:88000,single_parent:49000}, usc:[{upTo:12012,rate:0.005},{upTo:27382,rate:0.02},{upTo:70044,rate:0.03},{upTo:Infinity,rate:0.08}], prsi:{weeklyNil:352, creditStart:352.01, creditEnd:424, creditMax:12, rate1:0.041, rate2:0.042, weeks1:39, weeks2:13} };
      function calcPAYE(annual, totalCredits){ const band=TAX.bands[document.getElementById('status').value]||TAX.bands.single; const at20=Math.min(annual,band); const at40=Math.max(0,annual-band); let t=at20*TAX.standard+at40*TAX.higher; t -= Number(totalCredits||0); return Math.max(0,t); }
      function calcUSC(annual){ if(annual<13000) return 0; let rem=annual, last=0, u=0; for(const b of TAX.usc){ const cap=Math.min(rem,b.upTo-last); if(cap>0){u+=cap*b.rate; rem-=cap; last=b.upTo;} if(rem<=0) break;} return u; }
      function weeklyPRSI(weekly,isAfter){ if(weekly<=TAX.prsi.weeklyNil) return 0; const rate=isAfter?TAX.prsi.rate2:TAX.prsi.rate1; let ch=weekly*rate; if(weekly>TAX.prsi.creditStart && weekly<=TAX.prsi.creditEnd){ const p=(TAX.prsi.creditEnd-weekly)/(TAX.prsi.creditEnd-TAX.prsi.creditStart); ch=Math.max(0, ch - TAX.prsi.creditMax*p);} return ch; }
      function calcPRSI(annual){ const w=annual/52; return weeklyPRSI(w,false)*TAX.prsi.weeks1 + weeklyPRSI(w,true)*TAX.prsi.weeks2; }
      function renderTaxPie(gross,paye,usc,prsi){ const svg=document.getElementById('chartTaxPie'); const legend=document.getElementById('legendTax'); svg.innerHTML=''; legend.innerHTML=''; const w=420,h=260,cx=210,cy=130,r=90; const net=gross-(paye+usc+prsi); const items=[{name:'PAYE',val:paye,color:'#7c5cff'},{name:'USC',val:usc,color:'#22c55e'},{name:'PRSI',val:prsi,color:'#94a3b8'},{name:'Net',val:Math.max(0,net),color:'#f59e0b'}]; const total=Math.max(1, items.reduce((s,i)=>s+i.val,0)); let start=0; items.forEach(it=>{ const deg=360*(it.val/total); const path=arcPath(cx,cy,r,start,start+deg); svg.innerHTML += `<path d="${path}" fill="${it.color}"><title>${it.name}: ${fmt(it.val)}</title></path>`; start+=deg; legend.innerHTML += `<span><i class="dot" style="background:${it.color}"></i>${it.name} — ${fmt(it.val)}</span>`; }); svg.innerHTML += `<text x="${cx}" y="${cy+5}" text-anchor="middle" fill="#e5e7eb" font-size="14">Total: ${fmt(gross)}</text>`; }
      document.getElementById('calcTax').addEventListener('click', ()=>{ const a = state.annualGross || 0; document.getElementById('taxUsingGross').textContent = fmt(a); const baseCredits = Number(document.getElementById('credits').value||0); const rentCredit = Number(document.getElementById('rentCredit').value||0); const medicalEligible = Number(document.getElementById('medicalEligible').value||0); const medicalRelief = medicalEligible * 0.20; const totalCredits = baseCredits + rentCredit + medicalRelief; const paye=calcPAYE(a, totalCredits); const usc=calcUSC(a); const prsi=calcPRSI(a); const total=paye+usc+prsi; const net=Math.max(0,a-total); state.totalTax = total; state.netAnnual = net; document.getElementById('outPAYE').textContent=fmt(paye); document.getElementById('outUSC').textContent=fmt(usc); document.getElementById('outPRSI').textContent=fmt(prsi); document.getElementById('outTax').textContent=fmt(total); document.getElementById('netAnnual').textContent=fmt(net); document.getElementById('netMonthly').textContent=fmt(net/12); renderTaxPie(a,paye,usc,prsi); updateAllViews(); });

      // ===== Expenses =====
      const tbody = document.querySelector('#expTable tbody');
      const expenses = [];
      function expAnnual(amount,freq){ const v=Number(amount||0); if(freq==='weekly') return v*52; if(freq==='monthly') return v*12; return v; }
      function renderExpensesBars(items){ const svg=document.getElementById('chartExpenses'); svg.innerHTML=''; const w=420,h=260,p=24; const sorted=items.filter(i=>i.val>0).sort((a,b)=>b.val-a.val).slice(0,8); const max=Math.max(1, ...sorted.map(i=>i.val)); const barH=(h-2*p)/(sorted.length||1)-6; let y=p; sorted.forEach((it)=>{ const wid=(w-2*p)* (it.val/max); const rect=`<rect x="${p}" y="${y}" width="${wid}" height="${barH}" rx="6" fill="${it.color}"/>`; const label=`<text x="${p+6}" y="${y+barH-6}" fill="#0b0f14" font-size="12" font-weight="700">${it.name}</text>`; const value=`<text x="${p+wid-6}" y="${y+barH-6}" fill="#e5e7eb" font-size="12" text-anchor="end">${fmt(it.val/12)}/mo</text>`; svg.innerHTML += rect+label+value; y += barH+6; }); }
      function renderExp(){ tbody.innerHTML=''; let total=0; const cats=[]; expenses.forEach((e,i)=>{ const ann=expAnnual(e.amount,e.freq); cats.push({name:e.name||`Item ${i+1}`, val:ann, color: PALETTE[i % PALETTE.length]}); const tr=document.createElement('tr'); tr.innerHTML=`<td><input data-i="${i}" data-k="name" value="${e.name}"></td>
        <td><input type="number" step="0.01" min="0" data-i="${i}" data-k="amount" value="${e.amount}"></td>
        <td><select data-i="${i}" data-k="freq"><option value="monthly" ${e.freq==='monthly'?'selected':''}>Monthly</option><option value="weekly" ${e.freq==='weekly'?'selected':''}>Weekly</option><option value="annual" ${e.freq==='annual'?'selected':''}>Annual</option></select></td>
        <td class="mono">${fmt(ann)}</td>
        <td><button class="ghost" data-remove="${i}">✕</button></td>`; tbody.appendChild(tr); total+=ann; });
        document.getElementById('expTotal').textContent=fmt(total); document.getElementById('expTotalMonthly').textContent=fmt(total/12); renderExpensesBars(cats); return total; }
      document.getElementById('addExp').addEventListener('click',()=>{ expenses.push({name:'',amount:0,freq:'monthly'}); renderExp(); });
      document.getElementById('clearExp').addEventListener('click',()=>{ expenses.length=0; renderExp(); });
      tbody.addEventListener('input',e=>{ const i=e.target.getAttribute('data-i'); const k=e.target.getAttribute('data-k'); if(i!==null){ expenses[i][k]= k==='amount'? Number(e.target.value||0): e.target.value; }});
      tbody.addEventListener('click',e=>{ const i=e.target.getAttribute('data-remove'); if(i!==null){ expenses.splice(i,1); renderExp(); }});
      document.getElementById('calcExp').addEventListener('click',()=>{ state.expensesAnnual = renderExp(); updateAllViews(); });
      expenses.push({name:'Rent',amount:0,freq:'monthly'},{name:'Utilities',amount:0,freq:'monthly'},{name:'Transport',amount:0,freq:'monthly'}); renderExp();

      // ===== Saving & Spending pie (with pension slice) =====
      function renderSavingSpendingPie(){ const svg=document.getElementById('chartSpendingPie'); svg.innerHTML=''; const w=420,h=260,cx=210,cy=130,r=90; const netMo=state.netAnnual/12; const expMo=(state.expensesAnnual||0)/12; const eeMo=(state.eePct/100)*state.annualGross/12; const savMo=netMo*(state.saveRate||0); const freeMo=Math.max(0, netMo-expMo-eeMo-savMo); const items=[{name:'Expenses',val:expMo,color:'#7c5cff'},{name:'Pension (EE)',val:eeMo,color:'#a78bfa'},{name:'Savings',val:savMo,color:'#22c55e'},{name:'Free',val:freeMo,color:'#94a3b8'}]; const total=Math.max(1, items.reduce((s,i)=>s+i.val,0)); let start=0; items.forEach(it=>{ const deg=360*(it.val/total); const path=arcPath(cx,cy,r,start,start+deg); svg.innerHTML += `<path d="${path}" fill="${it.color}"><title>${it.name}: ${fmt(it.val)}/mo</title></path>`; start+=deg; }); svg.innerHTML += `<text x="${cx}" y="${cy+6}" text-anchor="middle" fill="#e5e7eb" font-size="14">Net: ${fmt(netMo)}/mo</text>`; document.getElementById('spNetMonthly').textContent=fmt(netMo); document.getElementById('spExpMonthly').textContent=fmt(expMo); document.getElementById('spPenMonthly').textContent=fmt(eeMo); document.getElementById('spFreeMonthly').textContent=fmt(freeMo); }

      // ===== Overview (goal timeline minimal) =====
      function renderGoalTimeline(){ const svg=document.getElementById('chartGoal'); svg.innerHTML=''; const w=420,h=260,p=36; const goal=Number(document.getElementById('goalAmount').value||0); const cur=Number(document.getElementById('goalCurrent').value||0); const mo=Number(document.getElementById('goalMonthly').value||0); if(goal<=0||mo<=0||cur>=goal){ return; } const months=Math.ceil((goal-cur)/mo); const vals=[]; for(let i=0;i<=months;i++){ vals.push(Math.min(goal, cur + i*mo)); } const max=goal; const sx=(w-2*p)/(vals.length-1||1); const sy=(h-2*p)/max; let d=''; vals.forEach((v,i)=>{ const x=p + i*sx; const y=h-p - v*sy; d += (i? ' L ':'M ')+x+' '+y; }); let grid=''; const years=Math.ceil(months/12); for(let y=0;y<=years;y++){ const i=Math.min(vals.length-1, Math.round((y/years)*(vals.length-1))); const x=p + i*sx; grid += `<line x1="${x}" y1="${h-p}" x2="${x}" y2="${p}" stroke="#1f2b3d" stroke-dasharray="4 4"/>` + `<text x="${x}" y="${h-p+16}" text-anchor="middle" fill="#9fb0c5" font-size="12">${y}y</text>`; } const yTicks=[0,0.25,0.5,0.75,1].map(fr=> fr*max); yTicks.forEach(v=>{ const y=h-p - v*sy; grid += `<line x1="${p}" y1="${y}" x2="${w-p}" y2="${y}" stroke="#1f2b3d" stroke-dasharray="4 4"/>` + `<text x="${p-8}" y="${y+4}" text-anchor="end" fill="#9fb0c5" font-size="12">${fmt(v)}</text>`; }); const endX=p + (vals.length-1)*sx; const endY=h-p - vals[vals.length-1]*sy; const endLabel = `${fmt(vals[vals.length-1])} / ${months}m`; svg.innerHTML = `${grid}<path d="${d}" fill="none" stroke="#22c55e" stroke-width="3"/>` + `<circle cx="${endX}" cy="${endY}" r="4" fill="#22c55e"/>` + `<text x="${endX-6}" y="${endY-8}" fill="#e5e7eb" font-size="12" text-anchor="end">${endLabel}</text>`; }

      // ===== Overview numbers =====
      function syncOverview(){ const netMo=state.netAnnual/12; const expMo=(state.expensesAnnual||0)/12; const saveMo=netMo*(state.saveRate||0); const freeYr=Math.max(0, state.netAnnual - (state.expensesAnnual||0)); const runway = expMo>0 ? (freeYr/expMo) : 0; document.getElementById('ovGross').textContent=fmt(state.annualGross); document.getElementById('ovTax').textContent=fmt(state.totalTax); document.getElementById('ovNet').textContent=fmt(state.netAnnual); document.getElementById('ovExp').textContent=fmt(state.expensesAnnual||0); document.getElementById('ovFree').textContent=fmt(freeYr); document.getElementById('ovSaveMo').textContent=fmt(saveMo); document.getElementById('ovRunway').textContent= runway? runway.toFixed(1): '—'; }

      // ===== Buttons & flows =====
      document.getElementById('calcSave').addEventListener('click',()=>{ state.saveRate = Number(document.getElementById('saveRate').value||0)/100; updateAllViews(); });
      document.getElementById('calcExp').addEventListener('click',()=>{ state.expensesAnnual = renderExp(); updateAllViews(); });
      document.getElementById('calcTax').addEventListener('click',()=>{ /* handled above */ });
      document.getElementById('calcGoal').addEventListener('click',()=>{ renderGoalTimeline(); });

      function updateAllViews(){ renderSavingSpendingPie(); renderGoalTimeline(); syncOverview(); }

      // init
      (function init(){ renderTaxPie(1,0,0,0); renderExpensesBars([]); renderSavingSpendingPie(); renderGoalTimeline(); syncOverview(); })();
    });
  </script>
</body>
</html>
