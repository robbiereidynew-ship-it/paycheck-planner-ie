<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Irish Money Planner — v4.6</title>
  <style>
    :root{--bg:#0b0f14;--ink:#e6edf3;--muted:#9fb0c5;--card:#101722;--line:#223044;--accent:#7c5cff;--accent2:#22c55e;--warn:#f59e0b}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--ink);background:radial-gradient(1200px 900px at 85% -20%,#1a2230 15%,transparent 60%) var(--bg)}
    header{position:sticky;top:0;z-index:50;background:#0b0f1490;backdrop-filter:blur(8px) saturate(160%);border-bottom:1px solid #141d2a}
    .nav{max-width:1200px;margin:auto;display:flex;gap:16px;align-items:center;padding:10px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .spacer{flex:1}
    .nav a{color:#cbd5e1;padding:8px 10px;border-radius:10px;text-decoration:none}
    .nav a:hover{background:#0e1622}
    main{max-width:1100px;margin:0 auto}
    section.page{min-height:100vh;display:flex;flex-direction:column;justify-content:center;padding:32px 16px;scroll-margin-top:76px}
    .card{background:linear-gradient(180deg,#101722,#0f141b);border:1px solid var(--line);border-radius:18px;padding:18px}
    h1{margin:0 0 10px;font-size:2rem}
    h2{margin:0 0 8px;font-size:1.25rem}
    .hint{color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #213144;background:#0c1219;color:var(--ink)}
    .primary{background:linear-gradient(180deg,var(--accent),#6a4bf6);border:none;cursor:pointer}
    .ghost{background:#0f172a;cursor:pointer}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px}
    .kpi{display:flex;justify-content:space-between;align-items:center;padding:12px;background:#0c1219;border:1px solid var(--line);border-radius:12px}
    .mono{font-variant-numeric:tabular-nums}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    .chart{background:#0c1219;border:1px solid var(--line);border-radius:14px;padding:8px;display:flex;align-items:center;justify-content:center;min-height:260px}
    .legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:8px}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 48 48"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7c5cff"/><stop offset="100%" stop-color="#22c55e"/></linearGradient></defs><rect x="6" y="6" width="36" height="36" rx="10" fill="url(#g)"/></svg>
      <span>Irish Money Planner — v4.6</span>
    </div>
    <div class="spacer"></div>
    <a href="#salary">Salary</a>
    <a href="#pension">Pension</a>
    <a href="#tax">Tax</a>
    <a href="#expenses">Expenses</a>
    <a href="#goals">Goals</a>
    <a href="#overview">Overview</a>
  </div>
</header>

<main>
  <!-- SALARY -->
  <section id="salary" class="page">
    <div class="split">
      <div>
        <h1>Salary</h1>
        <p class="hint">Choose frequency, enter amount, then click Calculate.</p>
        <div class="card">
          <div class="row">
            <div>
              <label>Input frequency</label>
              <select id="freq">
                <option value="annual">Annual</option>
                <option value="monthly">Monthly</option>
                <option value="biweekly">Bi‑weekly (26)</option>
                <option value="weekly">Weekly (52)</option>
                <option value="hourly">Hourly</option>
              </select>
            </div>
            <div>
              <label>Amount</label>
              <input id="amount" type="number" min="0" step="0.01" placeholder="e.g. 45000" />
            </div>
          </div>
          <div class="row" id="hoursRow" style="display:none;margin-top:10px"><div><label>Hours per week</label><input id="hours" type="number" min="0" step="0.1" value="39"/></div><div><label>&nbsp;</label><button id="presetFT" class="ghost" type="button">Set 39h / wk</button></div></div>
          <div class="row" style="margin-top:12px">
            <div><button id="calcSalary" class="primary" type="button">Calculate</button></div>
            <div class="row" style="grid-template-columns:repeat(3,1fr);gap:8px">
              <button type="button" class="ghost" data-preset="30000">Preset €30k</button>
              <button type="button" class="ghost" data-preset="45000">Preset €45k</button>
              <button type="button" class="ghost" data-preset="60000">Preset €60k</button>
            </div>
          </div>
          <div class="kpis">
            <div class="kpi"><span>Annual</span><strong class="mono" id="salAnnual">€0</strong></div>
            <div class="kpi"><span>Monthly</span><strong class="mono" id="salMonthly">€0</strong></div>
            <div class="kpi"><span>Bi‑weekly</span><strong class="mono" id="salBiweekly">€0</strong></div>
            <div class="kpi"><span>Weekly</span><strong class="mono" id="salWeekly">€0</strong></div>
          </div>
        </div>
      </div>
      <div class="card"><h2>Why this matters</h2><p class="hint">Every later section uses this number.</p></div>
    </div>
  </section>

  <!-- PENSION -->
  <section id="pension" class="page">
    <div class="split">
      <div>
        <h1>Pension</h1>
        <div class="card">
          <div class="row3">
            <div><label>Your % of gross</label><input id="eePct" type="number" min="0" max="100" step="0.1" value="5"></div>
            <div><label>Employer match %</label><input id="erPct" type="number" min="0" max="100" step="0.1" value="5"></div>
            <div><label>Assumed return %</label><input id="retPct" type="number" min="-10" max="20" step="0.1" value="5"></div>
          </div>
          <div class="row" style="margin-top:12px"><div><label>Years</label><input id="penYears" type="number" min="1" max="60" step="1" value="40"></div><div><label>&nbsp;</label><button id="calcPension" class="primary" type="button">Calculate</button></div></div>
          <div class="kpis"><div class="kpi"><span>Employee €/yr</span><strong class="mono" id="penEE">€0</strong></div><div class="kpi"><span>Employer €/yr</span><strong class="mono" id="penER">€0</strong></div><div class="kpi"><span>Monthly total</span><strong class="mono" id="penMonthly">€0</strong></div><div class="kpi"><span>Projected pot</span><strong class="mono" id="penPot">€0</strong></div></div>
        </div>
      </div>
      <div class="card"><h2>Growth over time</h2><div class="chart"><svg id="chartPension" viewBox="0 0 420 260" width="100%" height="100%"></svg></div></div>
    </div>
  </section>

  <!-- TAX -->
  <section id="tax" class="page">
    <div class="split">
      <div>
        <h1>Tax (Ireland 2025)</h1>
        <p class="hint">PAYE + USC + PRSI. Uses your Salary from page 1.</p>
        <div class="card">
          <div class="row3">
            <div><label>Status</label><select id="status"><option value="single" selected>Single</option><option value="married_one">Married (one income)</option><option value="married_two">Married (both incomes)</option><option value="single_parent">Single parent</option></select></div>
            <div><label>Base tax credits €/yr</label><input id="credits" type="number" min="0" step="1" value="4000"></div>
            <div><label>Rent tax credit €/yr</label><input id="rentCredit" type="number" min="0" step="1" value="0"></div>
          </div>
          <div class="row3" style="margin-top:12px"><div><label>Medical expenses eligible (€)</label><input id="medicalEligible" type="number" min="0" step="1" value="0"></div><div><label>&nbsp;</label><button id="calcTax" class="primary" type="button">Calculate</button></div><div><label>&nbsp;</label><div class="kpi"><span>Using gross</span><strong class="mono" id="taxUsingGross">€0</strong></div></div></div>
          <div class="kpis"><div class="kpi"><span>PAYE</span><strong class="mono" id="outPAYE">€0</strong></div><div class="kpi"><span>USC</span><strong class="mono" id="outUSC">€0</strong></div><div class="kpi"><span>PRSI</span><strong class="mono" id="outPRSI">€0</strong></div><div class="kpi"><span>Total tax</span><strong class="mono" id="outTax">€0</strong></div></div>
          <div class="kpis" style="grid-template-columns:repeat(2,1fr)"><div class="kpi"><span>Net annual</span><strong class="mono" id="netAnnual">€0</strong></div><div class="kpi"><span>Net monthly</span><strong class="mono" id="netMonthly">€0</strong></div></div>
        </div>
      </div>
      <div class="card"><h2>Tax split</h2><div class="chart"><svg id="chartTaxPie" viewBox="0 0 420 260" width="100%" height="100%"></svg></div><div class="legend" id="legendTax"></div></div>
    </div>
  </section>

  <!-- EXPENSES -->
  <section id="expenses" class="page">
    <div class="split">
      <div>
        <h1>Expenses</h1>
        <div class="card">
          <div class="row" style="margin-top:6px"><div><button id="addExp" type="button" class="ghost">+ Add expense</button></div><div><button id="clearExp" type="button" class="ghost">Clear</button></div><div><button id="calcExp" type="button" class="primary">Update</button></div></div>
          <table class="mt12" id="expTable" style="width:100%;border-collapse:collapse;margin-top:10px"><thead><tr><th>Name</th><th>Amount</th><th>Freq</th><th>Annualised</th><th></th></tr></thead><tbody></tbody><tfoot><tr><td colspan="3" style="text-align:right">Total (annual)</td><td id="expTotal" class="mono">€0</td><td></td></tr><tr><td colspan="3" style="text-align:right">Total (monthly)</td><td id="expTotalMonthly" class="mono">€0</td><td></td></tr></tfoot></table>
        </div>
      </div>
      <div class="card"><h2>Where it goes</h2><div class="chart"><svg id="chartExpenses" viewBox="0 0 420 260" width="100%" height="100%"></svg></div></div>
    </div>
  </section>

  <!-- GOALS -->
  <section id="goals" class="page">
    <div class="split">
      <div>
        <h1>Goals</h1>
        <div class="card">
          <div class="row" style="margin-top:6px"><div><label>Goal amount (€)</label><input id="goalAmount" type="number" min="0" step="1" value="10000"></div><div><label>Current saved (€)</label><input id="goalCurrent" type="number" min="0" step="1" value="0"></div></div>
          <div class="row" style="margin-top:12px"><div><label>Monthly contribution (€)</label><input id="goalMonthly" type="number" min="0" step="1" value="500"></div><div><label>&nbsp;</label><button id="calcGoal" class="primary" type="button">Calculate goal</button></div></div>
          <div class="kpis" style="grid-template-columns:repeat(3,1fr)"><div class="kpi"><span>Months to goal</span><strong class="mono" id="goalMonths">—</strong></div><div class="kpi"><span>Target date</span><strong class="mono" id="goalDate">—</strong></div><div class="kpi"><span>Monthly savings (for pie)</span><strong class="mono" id="ovSaveMo">€0</strong></div></div>
        </div>
      </div>
      <div class="card"><h2>Goal timeline</h2><div class="chart"><svg id="chartGoal" viewBox="0 0 420 260" width="100%" height="100%"></svg></div></div>
    </div>
  </section>

  <!-- OVERVIEW -->
  <section id="overview" class="page">
    <div class="split">
      <div>
        <h1>Overview</h1>
        <div class="card">
          <div class="kpis" style="grid-template-columns:repeat(4,1fr)">
            <div class="kpi"><span>Net monthly</span><strong class="mono" id="spNetMonthly">€0</strong></div>
            <div class="kpi"><span>Expenses monthly</span><strong class="mono" id="spExpMonthly">€0</strong></div>
            <div class="kpi"><span>Pension (EE) monthly</span><strong class="mono" id="spPenMonthly">€0</strong></div>
            <div class="kpi"><span>Savings monthly</span><strong class="mono" id="spSaveMonthly">€0</strong></div>
          </div>
          <div class="kpis"><div class="kpi"><span>Free to spend (mo)</span><strong class="mono" id="spFreeMonthly">€0</strong></div></div>
        </div>
      </div>
      <div class="card"><h2>Monthly split (pie)</h2><div class="chart"><svg id="chartSpendingPie" viewBox="0 0 420 260" width="100%" height="100%"></svg></div><div class="legend"><span><i class="dot" style="background:#7c5cff"></i>Expenses</span><span><i class="dot" style="background:#a78bfa"></i>Pension (EE)</span><span><i class="dot" style="background:#22c55e"></i>Savings (Goal)</span><span><i class="dot" style="background:#94a3b8"></i>Free</span></div></div>
    </div>
  </section>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    const fmt = n => Number(n||0).toLocaleString(undefined,{style:'currency',currency:'EUR',maximumFractionDigits:0});
    const state = { annualGross:0, netAnnual:0, totalTax:0, expensesAnnual:0, eePct:0 };
    const arcPath = (cx,cy,r,startDeg,endDeg)=>{ const toRad=a=> (a-90)*Math.PI/180; const a0=toRad(startDeg), a1=toRad(endDeg); const x0=cx+r*Math.cos(a0), y0=cy+r*Math.sin(a0); const x1=cx+r*Math.cos(a1), y1=cy+r*Math.sin(a1); const large=(endDeg-startDeg)>180?1:0; return `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`; };

    // ===== Salary =====
    const freqEl=document.getElementById('freq'), amountEl=document.getElementById('amount'), hoursRow=document.getElementById('hoursRow'), hoursEl=document.getElementById('hours');
    const toAnnual=(freq,amount,hours)=>{ const v=Number(amount||0); switch(freq){case 'annual':return v;case 'monthly':return v*12;case 'biweekly':return v*26;case 'weekly':return v*52;case 'hourly':return v*Number(hours||0)*52;default:return 0;}};
    const fillSalary=a=>{ document.getElementById('salAnnual').textContent=fmt(a); document.getElementById('salMonthly').textContent=fmt(a/12); document.getElementById('salBiweekly').textContent=fmt(a/26); document.getElementById('salWeekly').textContent=fmt(a/52); };
    document.getElementById('calcSalary').addEventListener('click', ()=>{ const a=toAnnual(freqEl.value,amountEl.value,hoursEl.value); state.annualGross=a; fillSalary(a); updateOverview(); });
    document.querySelectorAll('[data-preset]').forEach(b=>b.addEventListener('click',()=>{freqEl.value='annual';amountEl.value=b.getAttribute('data-preset');hoursRow.style.display='none';}));
    freqEl.addEventListener('change',()=>{hoursRow.style.display=freqEl.value==='hourly'?'':'none';}); document.getElementById('presetFT').addEventListener('click',()=>{hoursEl.value=39});

    // ===== Pension =====
    function fvSeries(monthly, years, annualReturn){ const r=(annualReturn/100)/12; const n=years*12; if(r===0) return monthly*n; return monthly*((Math.pow(1+r,n)-1)/r); }
    function renderPensionChart(monthly, years, annualReturn){ const svg=document.getElementById('chartPension'); svg.innerHTML=''; const w=420,h=260,p=36; const r=(annualReturn/100)/12; const n=years*12; const step=Math.max(1,Math.floor(n/120)); let vals=[],bal=0; for(let m=0;m<=n;m+=step){ if(m>0) bal=bal*(1+r)+monthly*step; vals.push({m,bal}); } const max=Math.max(1,...vals.map(v=>v.bal)); const sx=(w-2*p)/(vals.length-1||1), sy=(h-2*p)/max; let d=''; vals.forEach((v,i)=>{ const x=p+i*sx, y=h-p - v.bal*sy; d += (i?' L ':'M ')+x+' '+y; }); svg.innerHTML=`<path d="${d}" fill="none" stroke="#7c5cff" stroke-width="3"/>`; }
    document.getElementById('calcPension').addEventListener('click', ()=>{ const eePct=Number(document.getElementById('eePct').value||0); state.eePct=eePct; const ee=eePct/100*state.annualGross; const er=Number(document.getElementById('erPct').value||0)/100*state.annualGross; const monthly=(ee+er)/12; const years=Number(document.getElementById('penYears').value||0), ret=Number(document.getElementById('retPct').value||0); const fv=fvSeries(monthly,years,ret); document.getElementById('penEE').textContent=fmt(ee); document.getElementById('penER').textContent=fmt(er); document.getElementById('penMonthly').textContent=fmt(monthly); document.getElementById('penPot').textContent=fmt(fv); renderPensionChart(monthly,years,ret); updateOverview(); });

    // ===== Tax =====
    const TAX={ standard:0.20,higher:0.40,bands:{single:44000,married_one:53000,married_two:88000,single_parent:49000}, usc:[{upTo:12012,rate:0.005},{upTo:27382,rate:0.02},{upTo:70044,rate:0.03},{upTo:Infinity,rate:0.08}], prsi:{weeklyNil:352,creditStart:352.01,creditEnd:424,creditMax:12,rate1:0.041,rate2:0.042,weeks1:39,weeks2:13}};
    const calcPAYE=(annual,totalCredits)=>{ const band=TAX.bands[document.getElementById('status').value]||TAX.bands.single; const at20=Math.min(annual,band), at40=Math.max(0,annual-band); let t=at20*TAX.standard+at40*TAX.higher; t-=Number(totalCredits||0); return Math.max(0,t||0); };
    const calcUSC=annual=>{ if(annual<13000) return 0; let rem=annual,last=0,u=0; for(const b of TAX.usc){ const cap=Math.min(rem,b.upTo-last); if(cap>0){u+=cap*b.rate; rem-=cap; last=b.upTo;} if(rem<=0) break;} return Math.max(0,u||0); };
    const weeklyPRSI=(weekly,isAfter)=>{ if(weekly<=TAX.prsi.weeklyNil) return 0; const rate=isAfter?TAX.prsi.rate2:TAX.prsi.rate1; let ch=weekly*rate; if(weekly>TAX.prsi.creditStart && weekly<=TAX.prsi.creditEnd){ const p=(TAX.prsi.creditEnd-weekly)/(TAX.prsi.creditEnd-TAX.prsi.creditStart); ch=Math.max(0,ch - TAX.prsi.creditMax*p);} return Math.max(0,ch||0); };
    const calcPRSI=annual=>{ const w=annual/52; return weeklyPRSI(w,false)*TAX.prsi.weeks1 + weeklyPRSI(w,true)*TAX.prsi.weeks2; };
    function renderTaxPie(gross,paye,usc,prsi){ const svg=document.getElementById('chartTaxPie'); const legend=document.getElementById('legendTax'); if(!svg||!legend) return; const w=420,h=260,cx=210,cy=130,r=90; const net=Math.max(0,(gross||0)-(paye+usc+prsi)); const items=[{name:'PAYE',val:Math.max(0,paye),color:'#7c5cff'},{name:'USC',val:Math.max(0,usc),color:'#22c55e'},{name:'PRSI',val:Math.max(0,prsi),color:'#94a3b8'},{name:'Net',val:Math.max(0,net),color:'#f59e0b'}]; const total=items.reduce((s,i)=>s+i.val,0); if(!isFinite(total)||total<=0){ svg.innerHTML = `<circle cx="${cx}" cy="${cy}" r="90" fill="#0c1219" stroke="#1f2b3d"/><text x="${cx}" y="${cy+4}" text-anchor="middle" fill="#9fb0c5" font-size="14">Calculate tax to see chart</text>`; legend.innerHTML=''; return;} svg.innerHTML=''; legend.innerHTML=''; let start=0; for(const it of items){ const deg=360*(it.val/total); if(deg<=0) continue; const p=arcPath(cx,cy,r,start,start+deg); svg.insertAdjacentHTML('beforeend',`<path d="${p}" fill="${it.color}"><title>${it.name}: ${fmt(it.val)}</title></path>`); legend.insertAdjacentHTML('beforeend',`<span><i class="dot" style="background:${it.color}"></i>${it.name} — ${fmt(it.val)}</span>`); start+=deg; } svg.insertAdjacentHTML('beforeend',`<text x="${cx}" y="${cy+5}" text-anchor="middle" fill="#e5e7eb" font-size="14">Total: ${fmt(gross)}</text>`); }
    document.getElementById('calcTax').addEventListener('click',()=>{ const a=Number(state.annualGross||0); document.getElementById('taxUsingGross').textContent=fmt(a); const baseCredits=Number(document.getElementById('credits').value||0); const rentCredit=Number(document.getElementById('rentCredit').value||0); const med=Number(document.getElementById('medicalEligible').value||0); const medRelief=med*0.20; const credits=baseCredits+rentCredit+medRelief; const paye=calcPAYE(a,credits), usc=calcUSC(a), prsi=calcPRSI(a); const total=paye+usc+prsi; const net=Math.max(0,a-total); state.totalTax=total; state.netAnnual=net; document.getElementById('outPAYE').textContent=fmt(paye); document.getElementById('outUSC').textContent=fmt(usc); document.getElementById('outPRSI').textContent=fmt(prsi); document.getElementById('outTax').textContent=fmt(total); document.getElementById('netAnnual').textContent=fmt(net); document.getElementById('netMonthly').textContent=fmt(net/12); renderTaxPie(a,paye,usc,prsi); updateOverview(); });

    // ===== Expenses =====
    const tbody=document.querySelector('#expTable tbody'); const expenses=[]; const expAnnual=(amount,freq)=>{const v=Number(amount||0); if(freq==='weekly') return v*52; if(freq==='monthly') return v*12; return v;};
    function renderExpenses(){ tbody.innerHTML=''; let total=0; const svg=document.getElementById('chartExpenses'); svg.innerHTML=''; const w=420,h=260,p=24; let cats=[]; expenses.forEach((e,i)=>{ const ann=expAnnual(e.amount,e.freq); cats.push({name:e.name||`Item ${i+1}`, val:ann}); const tr=document.createElement('tr'); tr.innerHTML=`<td><input data-i="${i}" data-k="name" value="${e.name||''}"></td><td><input type="number" step="0.01" min="0" data-i="${i}" data-k="amount" value="${e.amount||0}"></td><td><select data-i="${i}" data-k="freq"><option value="monthly" ${e.freq==='monthly'?'selected':''}>Monthly</option><option value="weekly" ${e.freq==='weekly'?'selected':''}>Weekly</option><option value="annual" ${e.freq==='annual'?'selected':''}>Annual</option></select></td><td class="mono">${fmt(ann)}</td><td><button class="ghost" data-remove="${i}">✕</button></td>`; tbody.appendChild(tr); total+=ann; }); document.getElementById('expTotal').textContent=fmt(total); document.getElementById('expTotalMonthly').textContent=fmt(total/12);
      // bars
      const sorted=cats.filter(i=>i.val>0).sort((a,b)=>b.val-a.val).slice(0,8); const max=Math.max(1,...sorted.map(i=>i.val)); const barH=(h-2*p)/(sorted.length||1)-6; let y=p; sorted.forEach((it,idx)=>{ const wid=(w-2*p)*(it.val/max); svg.innerHTML += `<rect x="${p}" y="${y}" width="${wid}" height="${barH}" rx="6" fill="#7c5cff" opacity="${0.5+0.05*idx}"></rect>` + `<text x="${p+6}" y="${y+barH-6}" fill="#0b0f14" font-size="12" font-weight="700">${it.name}</text>` + `<text x="${p+wid-6}" y="${y+barH-6}" fill="#e5e7eb" font-size="12" text-anchor="end">${fmt(it.val/12)}/mo</text>`; y+=barH+6; }); return total; }
    document.getElementById('addExp').addEventListener('click',()=>{expenses.push({name:'',amount:0,freq:'monthly'}); renderExpenses();});
    document.getElementById('clearExp').addEventListener('click',()=>{expenses.length=0; renderExpenses();});
    tbody.addEventListener('input',e=>{ const i=e.target.getAttribute('data-i'); const k=e.target.getAttribute('data-k'); if(i!==null){ expenses[i][k]= k==='amount'? Number(e.target.value||0): e.target.value; }});
    tbody.addEventListener('click',e=>{ const i=e.target.getAttribute('data-remove'); if(i!==null){ expenses.splice(i,1); renderExpenses(); }});
    document.getElementById('calcExp').addEventListener('click',()=>{ state.expensesAnnual=renderExpenses(); updateOverview(); });
    expenses.push({name:'Rent',amount:0,freq:'monthly'},{name:'Utilities',amount:0,freq:'monthly'},{name:'Transport',amount:0,freq:'monthly'}); renderExpenses();

    // ===== Goals =====
    function renderGoalTimeline(){ const svg=document.getElementById('chartGoal'); svg.innerHTML=''; const w=420,h=260,p=36; const goal=Number(document.getElementById('goalAmount').value||0); const cur=Number(document.getElementById('goalCurrent').value||0); const mo=Number(document.getElementById('goalMonthly').value||0); if(goal<=0||mo<=0||cur>=goal){ return; } const months=Math.ceil((goal-cur)/mo); const vals=[]; for(let i=0;i<=months;i++){ vals.push(Math.min(goal,cur+i*mo)); } const max=goal; const sx=(w-2*p)/(vals.length-1||1), sy=(h-2*p)/max; let d=''; vals.forEach((v,i)=>{ const x=p+i*sx, y=h-p - v*sy; d += (i?' L ':'M ')+x+' '+y; }); svg.innerHTML = `<path d="${d}" fill="none" stroke="#22c55e" stroke-width="3"/>`; }
    document.getElementById('calcGoal').addEventListener('click',()=>{ const goal=Number(document.getElementById('goalAmount').value||0); const cur=Number(document.getElementById('goalCurrent').value||0); const mo=Number(document.getElementById('goalMonthly').value||0); if(mo<=0||goal<=cur){ document.getElementById('goalMonths').textContent='—'; document.getElementById('goalDate').textContent='—'; document.getElementById('ovSaveMo').textContent=fmt(0); updateOverview(); return; } const months=Math.ceil((goal-cur)/mo); const target=new Date(); target.setMonth(target.getMonth()+months); document.getElementById('goalMonths').textContent=months; document.getElementById('goalDate').textContent=target.toLocaleDateString(); document.getElementById('ovSaveMo').textContent=fmt(mo); renderGoalTimeline(); updateOverview(); });

    // ===== Overview pie =====
    function renderOverviewPie(){ const svg=document.getElementById('chartSpendingPie'); svg.innerHTML=''; const cx=210,cy=130,r=90; const netMo=state.netAnnual/12; const expMo=(state.expensesAnnual||0)/12; const eeMo=(state.eePct/100)*state.annualGross/12; const goalMo=Number(document.getElementById('goalMonthly').value||0); const freeMo=Math.max(0,netMo-expMo-eeMo-goalMo); const items=[{name:'Expenses',val:expMo,color:'#7c5cff'},{name:'Pension (EE)',val:eeMo,color:'#a78bfa'},{name:'Savings (Goal)',val:goalMo,color:'#22c55e'},{name:'Free',val:freeMo,color:'#94a3b8'}]; const total=Math.max(1,items.reduce((s,i)=>s+i.val,0)); let start=0; items.forEach(it=>{ const deg=360*(it.val/total); const p=arcPath(cx,cy,r,start,start+deg); svg.insertAdjacentHTML('beforeend',`<path d="${p}" fill="${it.color}"><title>${it.name}: ${fmt(it.val)}/mo</title></path>`); start+=deg; }); document.getElementById('spNetMonthly').textContent=fmt(netMo); document.getElementById('spExpMonthly').textContent=fmt(expMo); document.getElementById('spPenMonthly').textContent=fmt(eeMo); document.getElementById('spSaveMonthly').textContent=fmt(goalMo); document.getElementById('spFreeMonthly').textContent=fmt(freeMo); }
    function updateOverview(){ renderOverviewPie(); }

    // ===== Init placeholders (no fake €1 totals) =====
    (function init(){ const taxSvg=document.getElementById('chartTaxPie'); if(taxSvg){ taxSvg.innerHTML = `<circle cx="210" cy="130" r="90" fill="#0c1219" stroke="#1f2b3d"/><text x="210" y="135" text-anchor="middle" fill="#9fb0c5" font-size="14">Calculate tax to see chart</text>`; const leg=document.getElementById('legendTax'); if(leg) leg.innerHTML=''; } renderOverviewPie(); renderGoalTimeline(); })();
  });
</script>
</body>
</html>
